---
title: あなたはcopierの本当の価値を知らない
tags:
  - copier
  - cookiecutter
  - python
  - template
  - cli
url: "https://zenn.dev/atu4403/articles/copier-true-value-vs-cookiecutter"
emoji: "🔍"
type: "tech"
topics: ["copier", "cookiecutter", "python", "template", "cli"]
published: false
slug: "copier-true-value-vs-cookiecutter"
---


## Aくんのcopier発見物語

エンジニアのAくんは、新しいPythonプロジェクトを始めるたびに同じ作業を繰り返していました。テストディレクトリの作成、pytest.iniの設定、CONTRIBUTING.mdのコピー...。毎回同じファイルを以前のプロジェクトからコピーして、プロジェクト名だけを書き換える作業に疲れていたのです。

そんなとき、Aくんは`cookiecutter`というツールを発見しました。

「これは便利だ！」

テンプレートを作成しておけば、コマンド一つで新しいプロジェクトが生成される。Aくんはすっかりcookiecutterの虜になり、自分専用のPythonプロジェクトテンプレートを作成して愛用していました。

```bash
cookiecutter https://github.com/Akun/my-python-template.git
```

このコマンドを実行すると、プロジェクト名や作者名などの質問が表示され、回答に応じてカスタマイズされたプロジェクトが生成される。非常にスムーズなワークフローでした。

## 新しいツールとの出会い

ある日、Aくんは技術ブログを読んでいて`copier`というツールの存在を知りました。

「copier？cookiecutterと似たようなツールかな？」

調べてみると、copierもプロジェクト作成ツールの一つで、cookiecutterと同様にテンプレートからプロジェクトを生成できるとのこと。さらに興味深いことに、生成後のプロジェクトをテンプレートの更新に合わせてアップデートできる機能もあるようです。

「テンプレートをアップデートできるって、これは便利そうだ！」

新しもの好きのAくんは、さっそくcopierを試してみることにしました。cookiecutterで十分満足していましたが、より良いツールがあるなら使ってみたいと思ったのです。

## 最初の試行

Aくんは慣れ親しんだcookiecutterの感覚で、copierを実行してみました。

```bash
# cookiecutterならこんな感じ
cookiecutter https://github.com/some-user/copier-template.git

# copierでも同じような感じかな？
copier copy https://github.com/some-user/copier-template.git
```

しかし、実行してみると何かが違いました...

「あれ？なんかエラーが出てる。引数が足りないって言われてる」

ドキュメントを確認してみると、copierのコマンド構成はcookiecutterとは異なっていました。

```bash
copier copy path/to/project/template path/to/destination
```

「なるほど、出力先も指定する必要があるのか」

Aくんはcookiecutterの挙動を思い出しました。cookiecutterはカレントディレクトリにプロジェクトディレクトリを作成してくれます。きっとcopierでも同じで、カレントディレクトリ（`.`）を指定すれば、そこにプロジェクトディレクトリが作られるだろうと考えました。

偶然にも、Aくんは自分のDocumentsディレクトリにいました。

```bash
cd ~/Documents
copier copy gh:copier/template .
```

## 予想外の展開

コマンドは正常に実行され、テンプレートからの質問にも答えることができました。しかし、実行後にファイル一覧を見て、Aくんは青ざめました。

```
Documents/
├── README.md          # あれ？これテンプレートのファイル...
├── setup.py          # これも...
├── src/              # ディレクトリも作られてる
├── tests/            # テストディレクトリまで...
├── 家計簿.xlsx        # 元からあった大事なファイル
├── 会議資料.pdf       # 元からあった大事なファイル
├── 写真フォルダ/      # 元からあったディレクトリ
└── ...
```

「え！？何これ！？」

Aくんが期待していたのは、Documentsディレクトリの中に新しいプロジェクトディレクトリが作られることでした。しかし実際には、Documentsディレクトリ自体がPythonプロジェクトになってしまったのです。

「やばい...大事なファイルとテンプレートのファイルが混在してる！どれがどれだか分からない！」

慌てたAくんは、gitの履歴を確認したり、作成されたファイルを一つずつ削除したりして、なんとか元の状態に戻しました。

「cookiecutterとは全然違う挙動じゃないか...」

この失敗体験を通じて、Aくんはcopierがcookiecutterとは根本的に異なる設計思想を持っていることを実感しました。そして、この違いを理解することの重要性を痛感したのです。

## Aくんの挑戦と発見

## 退却は許されない

Documentsディレクトリを混乱させた失敗の後、Aくんは一瞬「cookiecutterに戻ろうかな...」と考えました。しかし、それは負けを認めることです。

「いや、まだだ。copierがこんなに注目されているのには理由があるはずだ」

負けず嫌いなAくんは、もう一度copierに挑戦することにしました。今度は慎重に、専用のディレクトリを作成してから実行します。

```bash
mkdir test-copier-project
cd test-copier-project
copier copy gh:copier/template .
```

今度は成功しました。テンプレートからの質問に答えて、無事にPythonプロジェクトが生成されました。

## 既存テンプレートへの違和感

生成されたプロジェクトを眺めながら、Aくんは違和感を覚えました。

「うーん、なんか微妙だな...」

具体的には以下のような点が気になりました：

- **pytest.iniの設定**：自分の好みとは違う設定になっている
- **CONTRIBUTING.md**：個人の小さなプロジェクトなのに、大きなOSSプロジェクト向けの内容
- **GitHub Actionsの設定**：複雑すぎて、シンプルなプロジェクトには過剰
- **ディレクトリ構造**：src/layout が採用されているが、今回は不要

「cookiecutterの時も同じような経験をしたな...」

Aくんは思い出しました。どんなテンプレートも、全てのユーザーのニーズに完璧に合うことはありません。結局、自分で一から作るか、既存のテンプレートを大幅に改変することになります。

## 自作テンプレートという選択肢

「やっぱり自分でテンプレートを作るしかないのかな」

Aくんは自分専用のcopierテンプレート作成を検討しました。しかし、すぐに気づきました。

- pytestの設定
- pre-commitの設定
- GitHub Actionsの設定
- CHANGELOGのファイル
- ライセンスのファイル

これら全てを一つのテンプレートに詰め込むのは、結局「万人向けで誰にも最適化されていない」テンプレートを作ることになります。

「これって車輪の再発明だよな...みんな同じような作業を繰り返している」

そんな時、Aくんはcopierの公式ドキュメントを読んでいて、興味深い記述を発見しました。

## 運命の発見

```
### 同じプロジェクトに複数のテンプレートを適用できるよ！

こんなシナリオを想像してみて！：
1. あるフレームワークの公開テンプレートを使ってプロジェクトを生成したい。
   それは `https://github.com/example-framework/framework-template.git` で公開されているよ。
2. 全てのプロジェクトに共通のpre-commit設定（フォーマッター、リンター、静的型チェッカーなど）を
   適用するための万能テンプレートがあるんだ。
   それは `https://gitlab.com/my-stuff/pre-commit-template.git` で公開済み。
3. 社内CIで動作するように設定するナイショのテンプレートがある。
   それは `git@gitlab.example.com:my-company/ci-template.git` にあるよ。

この3つのテンプレートは完全に独立してるんだ：
- 誰でもフレームワーク用のプロジェクトを生成できる。pre-commitを使うかどうかなんて関係ないよ！
- フレームワークに関係なく、同じpre-commit設定をみんなで共有したいよね。
- フレームワークやpre-commit設定に関係なく、全社プロジェクト向けの統一CI設定を持ちたいでしょ。

でも心配しないで！Copierが全部面倒見てくれるから。それぞれに違う回答ファイルを使うだけでOKだよ。
```

> [Configuring a template - copier](https://copier.readthedocs.io/en/stable/configuring/#applying-multiple-templates-to-the-same-subproject)
> _（ちょっと誇張して訳しています）_

「これだ！」

Aくんの目が輝きました。この記述を読んで、copierの真の価値が見えてきたのです。

## パラダイムシフト

「複数のテンプレートを同じプロジェクトに適用できる...」

Aくんの頭の中で、新しいアプローチが形になっていきました：

### 従来のアプローチ（cookiecutter）：

- 一つの巨大なテンプレート
- 全ての機能を詰め込む
- 不要な部分も含まれる
- カスタマイズが困難

### copierのアプローチ：

- 小さな専門特化したテンプレート
- 必要なものだけを組み合わせ
- 独立性を保ちながら協調
- 柔軟なカスタマイズ

「これなら、pytest専用テンプレート、pre-commit専用テンプレート、GitHub Actions専用テンプレートを別々に作って、必要に応じて組み合わせられる！」

## 新たな視点

この発見により、Aくんの copier に対する見方は180度変わりました。

**以前の認識：** 「cookiecutterの劣化コピー。コマンドも複雑だし、使いにくい」

**新しい認識：** 「全く異なる設計思想を持つ革新的なツール。分割統治の概念をプロジェクト生成に応用している」

さらに、`cp`コマンドとの類推も腑に落ちました：

```bash
# 複数のソースから同じ出力先へ
cp -r template1/* project/
cp -r template2/* project/
cp -r template3/* project/

# copierも同じ発想
copier copy template1 project/
copier copy template2 project/
copier copy template3 project/
```

## コミュニティへの貢献

「これは車輪の再発明じゃない。新しい車輪をコミュニティに提供することなんだ」

Aくんは興奮していました。小さな専門特化したテンプレートを作成すれば：

- 他の開発者も同じテンプレートを再利用できる
- メンテナンスも専門分野に集中できる
- 組み合わせ次第で無限の可能性が生まれる

「pytest設定のプロが作ったpytest専用テンプレート」「CI/CDのエキスパートが作ったGitHub Actions専用テンプレート」「ドキュメンテーションの専門家が作ったSphinx専用テンプレート」...

それぞれの専門家が得意分野のテンプレートを提供し、ユーザーは必要なものを組み合わせて使う。これこそが、copierが目指していた世界なのです。

## 新たなスタートライン

「cookiecutterとは全く違うツールなんだ。比較すること自体が間違いだった」

Aくんはようやく理解しました。copierはcookiecutterの代替品ではなく、全く新しいアプローチでプロジェクト作成の問題を解決しようとしているツールなのです。

失敗から始まったcopierとの出会いは、最終的にAくんに新しい視点を与えてくれました。そして今、Aくんは実際に小さなテンプレートを作成して、このエコシステムに貢献したいと考えています。

「よし、まずはpytest専用のシンプルなテンプレートから作ってみよう」

新たな挑戦への第一歩を踏み出そうとしていました。

## まとめ

この記事では、copierとcookiecutterの違いを実体験を通して学びました：

- **cookiecutter**: 一つの包括的なテンプレート
- **copier**: 複数の専門特化したテンプレートの組み合わせ

copierの真の価値は「分割統治」の概念をプロジェクト生成に応用したことです。小さな専門特化したテンプレートを組み合わせることで、より柔軟で再利用可能なプロジェクト生成が可能になります。

## 次のステップ

1. 自分の専門分野でミニマルなテンプレートを作成してみる
2. 既存のcopierテンプレートを組み合わせて使ってみる
3. コミュニティにテンプレートを公開して貢献する

copierは単なるcookiecutterの代替品ではなく、全く新しいアプローチでプロジェクト作成の問題を解決する革新的なツールなのです。
